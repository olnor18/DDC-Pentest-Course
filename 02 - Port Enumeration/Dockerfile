FROM ubuntu:20.04 as builder
RUN apt-get update && apt-get install -y \
    gcc \
    && rm -rf /var/lib/apt/lists/*

COPY main.c .
COPY main2.c .
RUN gcc main.c -o app
RUN gcc main2.c -o app2

################################

FROM ubuntu:20.04
WORKDIR /app
ARG DEBIAN_FRONTEND=noninteractive
ARG DEBCONF_NONINTERACTIVE_SEEN=true
RUN apt-get update && apt-get install -y \
    supervisor \
    apache2 \
    && rm -rf /var/lib/apt/lists/*

RUN mkdir -p /var/log/supervisor
COPY supervisord.conf /etc/supervisor/conf.d/supervisord.conf

# apache config
ENV APACHE_RUN_USER www-data
ENV APACHE_RUN_GROUP www-data
RUN mkdir /var/run/apache2
ENV APACHE_LOG_DIR /var/log/apache2
COPY index.html /var/www/html
COPY robots.txt /var/www/html
RUN chown -R www-data:www-data /var/www/

COPY --from=builder app .
COPY --from=builder app2 .
COPY ynetd .

EXPOSE 53 80 35672
CMD ["/usr/bin/supervisord"]